<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Veículos</title>
    <!-- Bibliotecas Externas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .modal-enter { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .tab-active { border-color: #2563eb; color: #2563eb; }
        .sidebar-link.active { background-color: #eef2ff; color: #1d4ed8; font-weight: 600; }
        @media print {
            .no-print { display: none !important; }
            body > #root { display: none !important; }
            .print-container { display: block !important; }
            .print-container > .print-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>
    <div class="print-container"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut, 
            GoogleAuthProvider, 
            signInWithPopup 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            doc, 
            onSnapshot, 
            query, 
            updateDoc, 
            where, 
            getDocs, 
            orderBy, 
            setDoc, 
            deleteDoc, 
            getDoc, 
            increment, 
            collectionGroup, 
            arrayUnion 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { 
            getStorage, 
            ref, 
            uploadBytes, 
            getDownloadURL, 
            deleteObject 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        window.firebase = { 
            initializeApp, 
            getAuth, 
            onAuthStateChanged, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut, 
            GoogleAuthProvider, 
            signInWithPopup, 
            getFirestore, 
            collection, 
            addDoc, 
            doc, 
            onSnapshot, 
            query, 
            updateDoc, 
            where, 
            getDocs, 
            orderBy, 
            setDoc, 
            deleteDoc, 
            getDoc, 
            getStorage, 
            ref, 
            uploadBytes, 
            getDownloadURL, 
            deleteObject, 
            increment, 
            collectionGroup, 
            arrayUnion 
        };
    </script>

    <!-- Utilidades, serviços e hooks globais -->
    <script src="utils/formatting.js"></script>
    <script src="utils/checklistPendencies.js"></script>
    <script src="services/carService.js"></script>
    <script src="contexts/CarDetailsContext.js"></script>
    <script src="hooks/useCarUI.js"></script>
    <script src="hooks/useCarData.js"></script>
    <script src="hooks/useCarActions.js"></script>

    <!-- Carregamento dos Componentes em Ordem CORRETA -->
    <script type="text/babel" data-presets="env,react" src="components/StarRatingInteractive.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/authscreen.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/loadingspinner.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/customalert.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/deleteconfirmationmodal.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/carformmodal.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/ImportDataModal.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/FinancialImportButton.js"></script>
    <!-- Recursos de mapa e controle de viagem removidos -->
    <script type="text/babel" data-presets="env,react" src="components/cardetailsheader.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/driverformmodal.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/PendencyFormModal.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/multiitemselector.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/expenseformmodal.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/revenueformmodal.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/reminderformmodal.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/expensestable.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/revenuestable.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/reminderstable.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/checklistslist.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/routinechecklistmodal.js?v=4"></script>
    <script type="text/babel" data-presets="env,react" src="components/deliverychecklistmodal.js"></script>

    <!-- Subcomponentes da tela de detalhes do carro -->
    <script type="text/babel" data-presets="env,react" src="components/cars/CarTabsHeader.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/cars/CarChecklistsTab.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/cars/CarFinancialTab.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/cars/CarMaintenanceTab.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/cars/CarServicesTab.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/cars/CarRemindersTab.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/cars/CarPendingsTab.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/cars/CarModalsManager.js"></script>
    
    <script type="text/babel" data-presets="env,react" src="components/cardetailspage.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/maintenanceitemmanager.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/fleetlistpage.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/driverspage.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/reportspage.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/PendingsReportPage.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/stockreportpage.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/pricecomparatorpage.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/workshopmanager.js"></script>
    <script type="text/babel" data-presets="env,react" src="components/dashboardpage.js"></script>
    
    <!-- O App.js deve ser o último componente a ser carregado -->
    <script type="text/babel" data-presets="env,react" src="components/app.js?v=2"></script>
    
    <script type="text/babel">
        // 1. Defina suas configurações
        const firebaseConfig = {
            apiKey: "AIzaSyD-FH6kF0XyvHY3E1xf3Ca0cBL0RYA1GYw",
            authDomain: "silicon-parity-462518-p1.firebaseapp.com",
            projectId: "silicon-parity-462518-p1",
            storageBucket: "gs://silicon-parity-462518-p1-afar3", // Verifique se o domínio está correto
            messagingSenderId: "923422896960",
            appId: "1:923422896960:web:4a7985a1cef9cec10080a5",
        };

        // 2. Pegue as funções do objeto global que você criou
        const { 
            initializeApp, 
            getAuth, 
            getFirestore,
            getStorage 
        } = window.firebase;

        // 3. INICIALIZE O FIREBASE
        const app = initializeApp(firebaseConfig);

        // 4. Crie instâncias dos serviços e as coloque no window para fácil acesso
        window.firebaseApp = app;
        window.firebaseAuth = getAuth(app);
        window.firebaseDb = getFirestore(app);
        window.firebaseStorage = getStorage(app);
        window.firebase_config = firebaseConfig;
        
        // Variável extra que você tinha
        window.app_instance_id = "5Uoss8SuxxMftQhEbzgn";

        // 5. Agora sim, renderize o App React, pois o Firebase já está pronto!
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
